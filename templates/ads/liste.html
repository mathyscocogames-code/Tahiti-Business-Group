{% extends 'base.html' %}
{% block title %}Annonces{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
  <div class="layout-with-sidebar">

    <div class="layout-main">
      <!-- Header + filtres -->
      <div class="bg-white border border-gray-200 rounded-2xl p-5 mb-6 shadow-sm">
        <h1 class="text-xl font-bold text-gray-900 mb-4">
          {% if cat_active %}
            {% for code, label in categories %}{% if code == cat_active %}{{ label }}{% endif %}{% endfor %}
          {% elif q %}R√©sultats pour "{{ q }}"{% else %}Toutes les annonces{% endif %}
        </h1>
        <form method="get">
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-3">
            <input type="text" name="q" value="{{ q }}" placeholder="Mot-cl√©..." class="form-input text-sm col-span-2 sm:col-span-1">
            <select name="categorie" class="form-input text-sm">
              <option value="">Toutes cat√©gories</option>
              {% for code, label in categories %}
              <option value="{{ code }}" {% if code == cat_active %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
            <input type="text" name="localisation" value="{{ ville }}" placeholder="Ville, √Æle..." class="form-input text-sm">
            <input type="number" name="prix_max" value="{{ prix_max }}" placeholder="Prix max XPF" class="form-input text-sm">
          </div>
          <div class="flex gap-2">
            <button type="submit" class="btn btn-primary text-sm">Filtrer</button>
            <a href="{% url 'liste_annonces' %}" class="btn btn-outline text-sm">R√©initialiser</a>
          </div>
        </form>
      </div>

      <div class="text-sm text-gray-500 mb-4 font-medium">
        {{ annonces.paginator.count }} annonce{{ annonces.paginator.count|pluralize }} trouv√©e{{ annonces.paginator.count|pluralize }}
      </div>

      {% if annonces %}
      <div class="ads-grid mb-8" id="annonces-grid">
        {% for annonce in annonces %}
        {% include 'partials/_annonce_card.html' %}
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if annonces.has_other_pages %}
      <div class="flex justify-center items-center gap-2">
        {% if annonces.has_previous %}
        <a href="?{% if q %}q={{ q }}&{% endif %}{% if cat_active %}categorie={{ cat_active }}&{% endif %}page={{ annonces.previous_page_number }}"
          class="btn btn-outline text-sm">‚Üê Pr√©c√©dent</a>
        {% endif %}
        <span class="text-sm text-gray-500 px-4">Page {{ annonces.number }} / {{ annonces.paginator.num_pages }}</span>
        {% if annonces.has_next %}
        <a href="?{% if q %}q={{ q }}&{% endif %}{% if cat_active %}categorie={{ cat_active }}&{% endif %}page={{ annonces.next_page_number }}"
          class="btn btn-primary text-sm">Suivant ‚Üí</a>
        {% endif %}
      </div>
      {% endif %}

      {% else %}
      <div class="bg-white border border-gray-200 rounded-2xl p-16 text-center shadow-sm">
        <div class="text-5xl mb-4">üîç</div>
        <h2 class="text-xl font-bold mb-2 text-gray-900">Aucun r√©sultat</h2>
        <p class="text-gray-500 mb-6">Essayez avec d'autres mots-cl√©s ou cat√©gories.</p>
        <a href="{% url 'liste_annonces' %}" class="btn btn-primary">Voir toutes les annonces</a>
      </div>
      {% endif %}
    </div>

    {% with categories=categories %}
    {% include 'partials/_sidebar_pubs.html' %}
    {% endwith %}

  </div>
</div>
{% endblock %}