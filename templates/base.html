<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>{% block title %}Tahiti Business Group{% endblock %} â€” Annonces PolynÃ©sie</title>
  <meta name="description" content="{% block meta_desc %}Annonces gratuites en PolynÃ©sie franÃ§aise. Achetez et vendez vÃ©hicules, immobilier, Ã©lectronique, emploi.{% endblock %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans:  ['Inter', 'system-ui', 'sans-serif'],
            serif: ['Libre Baskerville', 'Georgia', 'serif'],
          },
          colors: { primary: '#1a6cf1', accent: '#059669' }
        }
      }
    }
  </script>
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  {% block extra_head %}{% endblock %}
  <link rel="icon" type="image/svg+xml" href="{% static 'img/logo-tbg.svg' %}">
  <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}" sizes="any">
  <link rel="apple-touch-icon" href="{% static 'img/favicon-180.webp' %}">
  <link rel="manifest" href="{% static 'manifest.json' %}">
  <meta name="theme-color" content="#1a6cf1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="TBG">
  <!-- Open Graph -->
  <meta property="og:type"        content="website">
  <meta property="og:locale"      content="fr_PF">
  <meta property="og:site_name"   content="Tahiti Business Group">
  <meta property="og:title"       content="{% block og_title %}Tahiti Business Group â€” Annonces PolynÃ©sie{% endblock %}">
  <meta property="og:description" content="{% block og_desc %}Annonces gratuites en PolynÃ©sie franÃ§aise. VÃ©hicules, immobilier, Ã©lectronique, emploi.{% endblock %}">
  <link rel="canonical" href="{{ request.build_absolute_uri }}">
  <meta property="og:image"       content="{% block og_image %}{% static 'img/og-image.webp' %}{% endblock %}">
</head>
<body class="bg-gray-50 text-gray-900">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="bg-white sticky top-0 z-50 header-shadow">

  <!-- â”€â”€ Zone 1 : Logo Â· Recherche Â· Auth â”€â”€ -->
  <div class="border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 flex items-center h-16 gap-3">

      <!-- Logo -->
      <a href="{% url 'index' %}" class="flex-shrink-0 mr-2">
        <img src="{% static 'img/logo-tbg.svg' %}" alt="Tahiti Business Group" class="logo-header">
      </a>

      <!-- Barre de recherche -->
      <form action="{% url 'liste_annonces' %}" method="get" class="flex-1 max-w-2xl mx-auto">
        <div class="search-bar">
          <input type="text" name="q" value="{{ request.GET.q }}"
            placeholder="Rechercher une annonce..."
            class="search-bar__input">
          <button type="submit" class="search-bar__btn" aria-label="Rechercher">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </button>
        </div>
      </form>

      <!-- Actions droite -->
      <div class="flex items-center gap-2 flex-shrink-0">
        <a href="{% url 'deposer_annonce' %}" class="hidden sm:inline-flex items-center gap-1.5 bg-emerald-500 hover:bg-emerald-600 text-white font-bold px-4 py-2 rounded-xl text-sm transition shadow-sm">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"/>
          </svg>
          DÃ©poser
        </a>

        <!-- Hamburger catÃ©gories (mobile) -->
        <button class="hamburger-btn" onclick="openCatMenu()" aria-label="CatÃ©gories" id="hamburgerBtn">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
        {% if user.is_authenticated %}
        <!-- Messages badge -->
        <a href="{% url 'mes_messages' %}" class="msg-icon-header relative flex items-center justify-center w-9 h-9 rounded-xl hover:bg-gray-100 transition flex-shrink-0" title="Mes messages">
          <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
          {% if unread_count %}
          <span class="msg-badge absolute -top-0.5 -right-0.5 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center font-bold leading-none" style="font-size:9px">
            {{ unread_count }}
          </span>
          {% endif %}
        </a>
        <div class="cat-nav-item user-menu">
          <button class="flex items-center gap-2 px-2 py-1.5 rounded-xl hover:bg-gray-100 transition text-sm font-medium">
            <div class="w-7 h-7 bg-blue-600 rounded-full flex items-center justify-center text-white text-xs font-black flex-shrink-0">
              {{ user.nom|first|upper|default:user.email|first|upper }}
            </div>
            <span class="hidden md:block text-gray-700 max-w-24 truncate">{{ user.nom|default:user.email|truncatechars:14 }}</span>
            <svg class="w-3 h-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          <div class="cat-dropdown cat-dropdown--right">
            <div class="px-4 py-3 border-b border-gray-100 bg-gray-50">
              <div class="text-xs text-gray-500">{{ user.get_role_display }}</div>
              <div class="text-sm font-semibold text-gray-800 truncate mt-0.5">{{ user.email }}</div>
            </div>
            <a href="{% url 'mon_compte' %}">Mon compte</a>
            <a href="{% url 'mes_annonces' %}">Mes annonces</a>
            {% if user.is_staff %}
            <a href="{% url 'admin_dashboard' %}" class="user-menu-admin">Dashboard admin</a>
            <a href="/admin/" class="user-menu-django">Django Admin</a>
            {% endif %}
            <div class="user-menu-sep">
              <a href="{% url 'logout' %}" class="user-menu-logout">DÃ©connexion</a>
            </div>
          </div>
        </div>
        {% else %}
        <a href="{% url 'login' %}" class="text-sm text-gray-600 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-100 transition font-medium">Connexion</a>
        <a href="{% url 'register' %}" class="hidden sm:inline-block text-sm bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl transition font-semibold shadow-sm">Inscription</a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- â”€â”€ Zone 2 : Navigation catÃ©gories + dropdowns â”€â”€ -->
  <div id="cat-zone-2" class="border-b border-gray-200">
    <nav class="max-w-7xl mx-auto px-4 cat-nav" aria-label="CatÃ©gories">

      <a href="{% url 'liste_annonces' %}" class="cat-nav-link cat-nav-link--all">Tout</a>

      <!-- VÃ©hicules -->
      <div class="cat-nav-item">
        <a href="{% url 'liste_annonces' %}?categorie=vehicules" class="cat-nav-link">
          ğŸš— VÃ©hicules
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown">
          <div class="cat-dropdown__header">VÃ©hicules</div>
          <a href="{% url 'liste_annonces' %}?categorie=vehicules">Toutes</a>
          <a href="{% url 'liste_annonces' %}?categorie=vehicules&sous_cat=vehicules-4x4">Voitures / 4 roues</a>
          <a href="{% url 'liste_annonces' %}?categorie=vehicules&sous_cat=vehicules-2roues">2 roues (scooters/motos)</a>
          <a href="{% url 'liste_annonces' %}?categorie=vehicules&sous_cat=vehicules-bateaux">Bateaux &amp; jet-skis</a>
          <a href="{% url 'liste_annonces' %}?categorie=vehicules&sous_cat=vehicules-utilitaires">Utilitaires &amp; camions</a>
          <a href="{% url 'liste_annonces' %}?categorie=vehicules&sous_cat=vehicules-pieces">PiÃ¨ces auto &amp; accessoires</a>
        </div>
      </div>

      <!-- Immobilier -->
      <div class="cat-nav-item">
        <a href="{% url 'liste_annonces' %}?categorie=immobilier" class="cat-nav-link">
          ğŸ  Immobilier
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown">
          <div class="cat-dropdown__header">Immobilier</div>
          <a href="{% url 'liste_annonces' %}?categorie=immobilier">Toutes</a>
          <a href="{% url 'liste_annonces' %}?categorie=immobilier&sous_cat=immo-appartements">Appartements &amp; studios</a>
          <a href="{% url 'liste_annonces' %}?categorie=immobilier&sous_cat=immo-maisons">Maisons &amp; villas</a>
          <a href="{% url 'liste_annonces' %}?categorie=immobilier&sous_cat=immo-terrains">Terrains &amp; lots</a>
          <a href="{% url 'liste_annonces' %}?categorie=immobilier&sous_cat=immo-bureaux">Bureaux &amp; commerces</a>
          <a href="{% url 'liste_annonces' %}?categorie=immobilier&sous_cat=immo-saisonnieres">SaisonniÃ¨res (Arue/Papeete)</a>
          <a href="{% url 'liste_annonces' %}?categorie=immobilier&sous_cat=immo-parkings">Parkings &amp; garages</a>
        </div>
      </div>

      <!-- Ã‰lectronique -->
      <div class="cat-nav-item">
        <a href="{% url 'liste_annonces' %}?categorie=electronique" class="cat-nav-link">
          ğŸ“± Ã‰lectronique
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown">
          <div class="cat-dropdown__header">Ã‰lectronique</div>
          <a href="{% url 'liste_annonces' %}?categorie=electronique">Toutes</a>
          <a href="{% url 'liste_annonces' %}?categorie=electronique&sous_cat=elec-telephones">TÃ©lÃ©phones &amp; accessoires</a>
          <a href="{% url 'liste_annonces' %}?categorie=electronique&sous_cat=elec-ordinateurs">Ordinateurs &amp; tablettes</a>
          <a href="{% url 'liste_annonces' %}?categorie=electronique&sous_cat=elec-tv">TV &amp; Audio</a>
          <a href="{% url 'liste_annonces' %}?categorie=electronique&sous_cat=elec-jeux">Jeux vidÃ©o</a>
          <a href="{% url 'liste_annonces' %}?categorie=electronique&sous_cat=elec-electromenager">Ã‰lectromÃ©nager</a>
        </div>
      </div>

      <!-- Emploi -->
      <div class="cat-nav-item">
        <a href="{% url 'liste_annonces' %}?categorie=emploi" class="cat-nav-link">
          ğŸ’¼ Emploi
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown">
          <div class="cat-dropdown__header">Emploi</div>
          <a href="{% url 'liste_annonces' %}?categorie=emploi">Toutes</a>
          <a href="{% url 'liste_annonces' %}?categorie=emploi&sous_cat=emploi-commerciaux">Commerciaux</a>
          <a href="{% url 'liste_annonces' %}?categorie=emploi&sous_cat=emploi-informatique">Informatique &amp; DÃ©v</a>
          <a href="{% url 'liste_annonces' %}?categorie=emploi&sous_cat=emploi-hotellerie">HÃ´tellerie &amp; Resto</a>
          <a href="{% url 'liste_annonces' %}?categorie=emploi&sous_cat=emploi-btp">BTP &amp; Construction</a>
          <a href="{% url 'liste_annonces' %}?categorie=emploi&sous_cat=emploi-services">Services Ã  la personne</a>
        </div>
      </div>

      <!-- Services -->
      <div class="cat-nav-item">
        <a href="{% url 'liste_annonces' %}?categorie=services" class="cat-nav-link">
          ğŸ”§ Services
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown">
          <div class="cat-dropdown__header">Services</div>
          <a href="{% url 'liste_annonces' %}?categorie=services">Toutes</a>
          <a href="{% url 'liste_annonces' %}?categorie=services&sous_cat=services-travaux">Travaux &amp; BTP</a>
          <a href="{% url 'liste_annonces' %}?categorie=services&sous_cat=services-cours">Cours &amp; Formation</a>
          <a href="{% url 'liste_annonces' %}?categorie=services&sous_cat=services-transport">Transport</a>
          <a href="{% url 'liste_annonces' %}?categorie=services&sous_cat=services-sante">SantÃ© &amp; BeautÃ©</a>
          <a href="{% url 'liste_annonces' %}?categorie=services&sous_cat=services-jardinage">Jardinage</a>
        </div>
      </div>

      <!-- Autres -->
      <div class="cat-nav-item">
        <a href="{% url 'liste_annonces' %}?categorie=autres" class="cat-nav-link">
          ğŸ“¦ Autres
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown">
          <div class="cat-dropdown__header">Vente privÃ©e &amp; Autres</div>
          <a href="{% url 'liste_annonces' %}?categorie=autres">Toutes</a>
          <a href="{% url 'liste_annonces' %}?categorie=autres&sous_cat=autres-electronique">Ã‰lectronique &amp; PC</a>
          <a href="{% url 'liste_annonces' %}?categorie=autres&sous_cat=autres-meubles">Meubles &amp; DÃ©co</a>
          <a href="{% url 'liste_annonces' %}?categorie=autres&sous_cat=autres-vetements">VÃªtements &amp; Mode</a>
          <a href="{% url 'liste_annonces' %}?categorie=autres&sous_cat=autres-sport">Sport &amp; Loisirs</a>
          <a href="{% url 'liste_annonces' %}?categorie=autres&sous_cat=autres-puericulture">PuÃ©riculture</a>
        </div>
      </div>

      <div class="cat-nav-item">
        <a href="{% url 'rubriques_index' %}" class="cat-nav-link">
          ğŸ“° Rubriques
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown cat-dropdown--right">
          <div class="cat-dropdown__header">Rubriques TBG</div>
          <a href="{% url 'rubriques_index' %}">ğŸ’° Promos pro</a>
          <a href="{% url 'rubriques_index' %}">ğŸ“° ActualitÃ©s</a>
          <a href="{% url 'rubriques_index' %}">ğŸš€ NouveautÃ©s business</a>
          {% if user.is_pro %}<a href="{% url 'deposer_promo' %}">â• DÃ©poser une promo</a>{% endif %}
          {% if user.is_staff %}<a href="{% url 'moderation_dashboard' %}">ğŸ›¡ï¸ ModÃ©ration</a>{% endif %}
        </div>
      </div>

      <div class="cat-nav-item">
        <a href="{% url 'page_info' %}" class="cat-nav-link">
          ğŸ“¢ Info
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown cat-dropdown--right">
          <div class="cat-dropdown__header">Informations</div>
          <a href="{% url 'page_info' %}">Comment utiliser</a>
          <a href="{% url 'page_info' %}#tarifs">Tarifs publicitÃ©s</a>
          <a href="{% url 'page_info' %}#contact">Nous contacter</a>
          <a href="{% url 'page_info' %}#faq">FAQ</a>
        </div>
      </div>

      <div class="cat-nav-item">
        <a href="{% url 'page_business' %}" class="cat-nav-link">
          ğŸ’¼ Business
          <svg class="cat-nav-chevron w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
        <div class="cat-dropdown cat-dropdown--right">
          <div class="cat-dropdown__header">Business Tahiti</div>
          <a href="{% url 'page_business' %}">NouveautÃ©s Tahiti</a>
          <a href="{% url 'page_business' %}#recrutements">Recrutements</a>
          <a href="{% url 'page_business' %}#tendances">Tendances marchÃ©</a>
          <a href="{% url 'page_business' %}#partenaires">Partenaires</a>
        </div>
      </div>

      <div class="flex-1"></div>

      <a href="{% url 'tarifs_pubs' %}" class="cat-nav-link cat-nav-link--pub flex-shrink-0">âœ¦ Faire de la pub</a>
    </nav>
  </div>

</header>

<!-- â•â•â• SLIDE MENU â€” CatÃ©gories (mobile) â•â•â• -->
<div class="slide-overlay" id="slideOverlay" onclick="closeCatMenu()"></div>
<div class="slide-menu" id="slideMenu">
  <div class="slide-menu__header">
    <span class="font-bold text-gray-900 text-base">CatÃ©gories</span>
    <button onclick="closeCatMenu()" class="slide-menu__close" aria-label="Fermer">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>
  <div class="slide-menu__body">
    <a href="{% url 'liste_annonces' %}" class="slide-cat-link slide-cat-link--all"><span class="slide-cat-icon">ğŸ”</span>Â Toutes les annonces</a>
    <a href="{% url 'liste_annonces' %}?categorie=vehicules" class="slide-cat-link"><span class="slide-cat-icon">ğŸš—</span>Â VÃ©hicules</a>
    <a href="{% url 'liste_annonces' %}?categorie=immobilier" class="slide-cat-link"><span class="slide-cat-icon">ğŸ </span>Â Immobilier</a>
    <a href="{% url 'liste_annonces' %}?categorie=electronique" class="slide-cat-link"><span class="slide-cat-icon">ğŸ“±</span>Â Ã‰lectronique</a>
    <a href="{% url 'liste_annonces' %}?categorie=emploi" class="slide-cat-link"><span class="slide-cat-icon">ğŸ’¼</span>Â Emploi</a>
    <a href="{% url 'liste_annonces' %}?categorie=services" class="slide-cat-link"><span class="slide-cat-icon">ğŸ”§</span>Â Services</a>
    <a href="{% url 'liste_annonces' %}?categorie=autres" class="slide-cat-link"><span class="slide-cat-icon">ğŸ“¦</span>Â Autres</a>
    <div class="slide-menu__sep"></div>
    <div class="slide-menu__section-title">Infos &amp; Aide</div>
    <a href="{% url 'page_info' %}" class="slide-cat-link"><span class="slide-cat-icon">ğŸ“¢</span>Â Guide &amp; FAQ</a>
    <a href="{% url 'tarifs_pubs' %}" class="slide-cat-link"><span class="slide-cat-icon">ğŸ’°</span>Â Tarifs publicitÃ©s</a>
    <div class="slide-menu__sep"></div>
    <div class="slide-menu__section-title">Business Tahiti</div>
    <a href="{% url 'page_business' %}" class="slide-cat-link"><span class="slide-cat-icon">ğŸ’¼</span>Â NouveautÃ©s &amp; Recrutements</a>
    <div class="slide-menu__sep"></div>
    <div class="slide-menu__section-title">Rubriques</div>
    <a href="{% url 'rubriques_index' %}" class="slide-cat-link"><span class="slide-cat-icon">ğŸ“°</span>Â Promo, Info &amp; NouveautÃ©s</a>
    {% if user.is_pro %}
    <a href="{% url 'deposer_promo' %}" class="slide-cat-link"><span class="slide-cat-icon">ğŸ’°</span>Â DÃ©poser une promo</a>
    <a href="{% url 'deposer_nouveaute' %}" class="slide-cat-link"><span class="slide-cat-icon">ğŸš€</span>Â Publier une nouveautÃ©</a>
    {% endif %}
    {% if user.is_staff %}
    <a href="{% url 'moderation_dashboard' %}" class="slide-cat-link slide-cat-link--admin"><span class="slide-cat-icon">ğŸ›¡ï¸</span>Â ModÃ©ration</a>
    <a href="{% url 'admin_stats' %}" class="slide-cat-link slide-cat-link--admin"><span class="slide-cat-icon">ğŸ“Š</span>Â Dashboard stats</a>
    {% endif %}
    <div class="slide-menu__sep"></div>
    <a href="{% url 'deposer_annonce' %}" class="slide-cat-link slide-cat-link--cta"><span class="slide-cat-icon">âœš</span>Â DÃ©poser une annonce</a>
  </div>
</div>

<!-- MESSAGES -->
{% if messages %}
<div class="max-w-7xl mx-auto px-4 pt-3 space-y-2" style="position:relative;z-index:3;">
  {% for message in messages %}
  <div class="flex items-center gap-3 p-3.5 rounded-xl border text-sm font-medium
    {% if message.tags == 'success' %}bg-green-50 border-green-200 text-green-800
    {% elif message.tags == 'error' %}bg-red-50 border-red-200 text-red-800
    {% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-200 text-yellow-800
    {% else %}bg-blue-50 border-blue-200 text-blue-800{% endif %}">
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- â•â•â• PUB ARRIÃˆRE-PLAN FIXE PLEINE PAGE (index + liste uniquement) â•â•â• -->
{% with url=request.resolver_match.url_name %}
{% if url != 'deposer_annonce' and url != 'mes_favoris' and url != 'mes_messages' and url != 'mon_compte' and url != 'edit_annonce' and url != 'login' and url != 'register' and url != 'page_info' and url != 'page_business' and url != 'rubriques_index' %}
<div class="pub-bg-fixed">
  {% if pub_billboard %}
  <a href="{{ pub_billboard.lien }}" target="_blank" rel="noopener sponsored" class="pub-bg-fixed-link">
    <img src="{{ pub_billboard.get_image }}" alt="{{ pub_billboard.titre }}" class="pub-bg-fixed-img">
  </a>
  {% else %}
  <a href="{% url 'tarifs_pubs' %}" class="pub-bg-fixed-empty">
    <div style="color:#fff;font-size:clamp(20px,4vw,48px);font-weight:900;letter-spacing:-.02em;text-align:center">ğŸ“¢ VOTRE PUB ICI</div>
    <div style="color:rgba(255,255,255,.9);font-size:clamp(14px,2.5vw,28px);font-weight:700">25 000 XPF / mois</div>
    <div style="color:rgba(255,255,255,.7);font-size:clamp(12px,1.5vw,18px);font-weight:600;text-decoration:underline">RÃ©server â†’ 89 61 06 13</div>
  </a>
  {% endif %}
</div>
{% endif %}
{% endwith %}

{% block pub_spacer %}{% endblock %}
<main>{% block content %}{% endblock %}</main>

<!-- FOOTER -->
<footer class="bg-white border-t border-gray-200 mt-16">
  <div class="max-w-7xl mx-auto px-4 py-12">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">

      <div class="md:col-span-2">
        <div class="flex items-center gap-2 mb-3">
          <div class="w-9 h-9 bg-blue-600 rounded-xl flex items-center justify-center text-white font-black text-xs">TBG</div>
          <span class="font-bold text-lg">Tahiti Business <span class="text-blue-600">Groupe</span></span>
        </div>
        <p class="text-gray-500 text-sm leading-relaxed max-w-sm">
          La plateforme d'annonces gratuites #1 en PolynÃ©sie franÃ§aise. Achetez, vendez, Ã©changez en toute confiance.
        </p>
        <div class="mt-5 space-y-2">
          <a href="tel:0689610613" class="flex items-center gap-2 text-sm text-gray-700 hover:text-blue-600 transition font-medium w-fit">
            ğŸ“ 89 61 06 13
          </a>
          <a href="mailto:cocogamestahiti@gmail.com" class="flex items-center gap-2 text-sm text-gray-500 hover:text-blue-600 transition w-fit">
            âœ‰ï¸ cocogamestahiti@gmail.com
          </a>
        </div>
      </div>

      <div>
        <h4 class="text-xs font-bold uppercase tracking-wider mb-3 text-gray-900">CatÃ©gories</h4>
        <ul class="space-y-1.5 text-sm text-gray-500">
          <li><a href="{% url 'liste_annonces' %}?categorie=vehicules" class="hover:text-blue-600 transition">ğŸš— VÃ©hicules</a></li>
          <li><a href="{% url 'liste_annonces' %}?categorie=immobilier" class="hover:text-blue-600 transition">ğŸ  Immobilier</a></li>
          <li><a href="{% url 'liste_annonces' %}?categorie=electronique" class="hover:text-blue-600 transition">ğŸ“± Ã‰lectronique</a></li>
          <li><a href="{% url 'liste_annonces' %}?categorie=emploi" class="hover:text-blue-600 transition">ğŸ’¼ Emploi</a></li>
          <li><a href="{% url 'liste_annonces' %}?categorie=services" class="hover:text-blue-600 transition">ğŸ”§ Services</a></li>
          <li><a href="{% url 'liste_annonces' %}?categorie=autres" class="hover:text-blue-600 transition">ğŸ“¦ Autres</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-xs font-bold uppercase tracking-wider mb-3 text-gray-900">PublicitÃ©</h4>
        <ul class="space-y-1.5 text-sm text-gray-500">
          <li><a href="{% url 'tarifs_pubs' %}" class="hover:text-blue-600 transition">Tarifs &amp; emplacements</a></li>
          <li><a href="{% url 'demande_pub' %}" class="hover:text-blue-600 transition">RÃ©server un emplacement</a></li>
          <li class="pt-2 border-t border-gray-100 space-y-1">
            <div class="text-xs">Billboard â€” <strong class="text-gray-800">25 000 XPF/mois</strong></div>
            <div class="text-xs">Sidebar Haut â€” <strong class="text-gray-800">15 000 XPF/mois</strong></div>
            <div class="text-xs">Sidebar Milieu â€” <strong class="text-gray-800">10 000 XPF/mois</strong></div>
            <div class="text-xs">Sidebar Bas â€” <strong class="text-gray-800">5 000 XPF/mois</strong></div>
          </li>
        </ul>
      </div>

    </div>
    <div class="pt-6 border-t border-gray-100 flex flex-col sm:flex-row justify-between items-center gap-2">
      <p class="text-gray-400 text-xs">Â© 2026 Tahiti Business Group â€¢ 89 61 06 13 â€¢ cocogamestahiti@gmail.com</p>
      <p class="text-gray-300 text-xs">PolynÃ©sie franÃ§aise ğŸŒº</p>
    </div>
  </div>
</footer>

<!-- Bottom navigation (mobile) -->
<nav class="bottom-nav" aria-label="Navigation mobile">

  <a href="{% url 'index' %}" class="bottom-nav__item">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
    </svg>
    <span>Accueil</span>
  </a>

  <a href="{% url 'liste_annonces' %}" class="bottom-nav__item">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
    </svg>
    <span>Annonces</span>
  </a>

  <a href="{% url 'deposer_annonce' %}" class="bottom-nav__item bottom-nav__item--deposer">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"/>
    </svg>
  </a>

  <a href="{% url 'mes_favoris' %}" class="bottom-nav__item{% if request.resolver_match.url_name == 'mes_favoris' %} bottom-nav__item--active{% endif %}">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
    </svg>
    <span>Favoris</span>
  </a>

  <a href="{% url 'mes_messages' %}" class="bottom-nav__item">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
    </svg>
    {% if unread_count %}<span class="bottom-nav__badge">{{ unread_count }}</span>{% endif %}
    <span>Messages</span>
  </a>

  {% if user.is_authenticated %}
  <a href="{% url 'mon_compte' %}" class="bottom-nav__item">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
    </svg>
    <span>Compte</span>
  </a>
  {% else %}
  <a href="{% url 'login' %}" class="bottom-nav__item">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
    </svg>
    <span>Connexion</span>
  </a>
  {% endif %}

</nav>

{% load static %}
<script src="{% static 'js/main.js' %}"></script>
{% block extra_js %}{% endblock %}

<!-- â•â•â• CONTACT MODAL â•â•â• -->
<div id="contactModal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeContact()">
  <div class="modal-box">
    <div class="modal-header">
      <span class="font-bold text-gray-900 text-sm">âœ‰ï¸ Contacter le vendeur</span>
      <button onclick="closeContact()" class="modal-close-btn" aria-label="Fermer">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div id="modalContent" class="modal-body">
      <div class="text-center py-10 text-gray-400">
        <div class="text-4xl mb-2">&#x1F4AC;</div>Chargementâ€¦
      </div>
    </div>
  </div>
</div>

<script>
// â”€â”€ Slide menu catÃ©gories â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openCatMenu() {
  document.getElementById('slideMenu').classList.add('slide-menu--open');
  document.getElementById('slideOverlay').classList.add('slide-overlay--visible');
  document.body.style.overflow = 'hidden';
}
function closeCatMenu() {
  document.getElementById('slideMenu').classList.remove('slide-menu--open');
  document.getElementById('slideOverlay').classList.remove('slide-overlay--visible');
  document.body.style.overflow = '';
}
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeCatMenu(); });
</script>

<script>
// â”€â”€ Contact Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openContact(url) {
  const modal = document.getElementById('contactModal');
  const content = document.getElementById('modalContent');
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
  content.innerHTML = '<div class="text-center py-10 text-gray-400"><div class="text-4xl mb-2">&#x1F4AC;</div>Chargementâ€¦</div>';
  fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
    .then(r => r.json())
    .then(data => {
      if (data.error) { closeContact(); return; }
      content.innerHTML = data.html;
      const t = document.getElementById('chatThread');
      if (t) t.scrollTop = t.scrollHeight;
      const form = document.getElementById('contactForm');
      if (form) form.addEventListener('submit', submitContact);
    })
    .catch(() => {
      content.innerHTML = '<div class="text-center py-8 text-red-400">Erreur de chargement</div>';
    });
}

function closeContact() {
  document.getElementById('contactModal').style.display = 'none';
  document.body.style.overflow = '';
}

function submitContact(e) {
  e.preventDefault();
  const form = e.target;
  const url  = form.dataset.url;
  const btn  = form.querySelector('button[type=submit]');
  btn.disabled = true;
  fetch(url, {
    method: 'POST',
    body: new FormData(form),
    headers: { 'X-Requested-With': 'XMLHttpRequest' }
  })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        let t = document.getElementById('chatThread');
        if (!t) {
          t = document.createElement('div');
          t.id = 'chatThread';
          t.className = 'chat-thread';
          form.before(t);
          // Remove empty state if present
          const empty = t.previousSibling;
        }
        t.insertAdjacentHTML('beforeend', data.html);
        t.scrollTop = t.scrollHeight;
        form.querySelector('textarea').value = '';
        // Clear badge since we just sent a message
        const badge = document.querySelector('.msg-badge');
        if (badge) badge.remove();
      }
      btn.disabled = false;
    })
    .catch(() => { btn.disabled = false; });
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeContact(); });
</script>

</body>
</html>